<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.repository.follow.FollowMapper">

<resultMap id="userMap" type="com.example.domain.user.User" autoMapping="true">
    <result property="name" column="name" />
  </resultMap>

<resultMap id="followingMap" type="com.example.domain.follow.Follow" autoMapping="true">
    <result property="followedId" column="followed_id" />
    <association property="user" resultMap="userMap"/>
  </resultMap>

	<!-- フォロー機能 -->
	<select id="findFollowingList" resultMap="followingMap">
		SELECT
			u.name
		FROM
			users AS u
		INNER JOIN
      		follow AS f
    	ON
    		u.id = f.followed_id
    	WHERE
     		f.following_id
		IN
			(#{userId})
		ORDER BY
			f.followed_id
			
	</select>
	
	<!-- フォロワー機能 -->
	<select id="findFollowedList" resultMap="followingMap">
	SELECT
			u.name
		FROM
			users AS u
		INNER JOIN
      		follow AS f
    	ON
    		u.id = f.following_id
    	WHERE
     		f.followed_id
     	IN
			(#{userId})
    	ORDER BY
    		f.following_id
	</select>	
	<!-- マイページ機能 -->
	<select id="findMyPage" resultMap="userMap">
	SELECT
		u.mail_address,
		u.name,
		u.date_of_birth
	FROM
		users AS u
	WHERE
		u.id = (#{userId})

	</select>

</mapper>
